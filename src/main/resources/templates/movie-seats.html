<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{layout :: layout(~{::title}, ~{::main})}">
<head>
    <title th:text="${movie.title + ' - Select Seats'}">Select Seats</title>
    <style>
        .screen {
            background: linear-gradient(to bottom, #fff, #d3d3d3);
            height: 100px;
            width: 90%;
            margin: 30px auto;
            transform: rotateX(-30deg);
            box-shadow: 0 3px 20px rgba(0,0,0,0.3);
            text-align: center;
            line-height: 100px;
            font-weight: bold;
            color: #333;
            border-radius: 5px;
            font-size: 1.2em;
        }
        .seat-container {
            perspective: 1000px;
            margin: 60px auto;
            background-color: #2c3e50;
            padding: 40px 20px;
            border-radius: 15px;
            box-shadow: 0 0 30px rgba(0,0,0,0.2);
            max-width: 900px;
        }
        .seats {
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: center;
        }
        .seat-row {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
            margin: 15px 0;
            position: relative;
            padding-left: 50px;
            width: 100%;
            max-width: 800px;
        }
        .row-label {
            position: absolute;
            left: 20px;
            font-size: 1.2em;
            font-weight: bold;
            color: #ecf0f1;
        }
        .seat {
            height: 45px;
            width: 50px;
            margin: 5px;
            border-radius: 10px;
            background: linear-gradient(to bottom, #d4af37, #b8860b);
            border: 1px solid #ffd700;
            color: #fff8dc;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(218,165,32,0.3);
            transition: 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            position: relative;
            cursor: pointer;
            text-align: center;
            font-size: 14px;
            user-select: none;
            z-index: 1;
        }
        .seat:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(255,215,0,0.6);
        }
        .seat::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 4px;
            right: 4px;
            height: 4px;
            background: rgba(0,0,0,0.2);
            border-bottom-left-radius: 4px;
            border-bottom-right-radius: 4px;
        }
        .seat::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, rgba(255,255,255,0.2), transparent);
            border-radius: inherit;
            pointer-events: none;
        }
        .seat::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 0;
            right: 0;
            height: 8px;
            background: inherit;
            filter: brightness(70%);
            transform: skewX(45deg);
            transform-origin: 0 0;
        }
        .seat.vip {
            background: linear-gradient(to bottom, #f1c40f, #f39c12);
            border-color: #f39c12;
            box-shadow: 0 4px 15px rgba(243,156,18,0.3);
        }
        .seat.couple {
            background: linear-gradient(to bottom, #e91e63, #c2185b);
            width: 100px;
            border-color: #c2185b;
            box-shadow: 0 4px 15px rgba(233,30,99,0.3);
        }
        .seat.selected {
  background: linear-gradient(to bottom, #27ae60, #145a32);
  border-color: #27ae60;
}
     .seat.booked {
  background: #7f8c8d;
  cursor: not-allowed;
  color: #ccc;
}
        .seat:not(.booked):hover {
            transform: scale(1.15) translateZ(15px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }
        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 30px 0;
            padding: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(255,255,255,0.9);
            padding: 10px 20px;
            border-radius: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .legend-item .seat {
            transform: scale(0.7);
            margin: 0;
        }
        .legend-item small {
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.95em;
        }
        .summary {
            text-align: center;
            background: rgba(255,255,255,0.95);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            margin-top: 40px;
            font-size: 1.1em;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <main>
        <div class="container">
            <h2 class="text-center mb-4" th:text="${movie.title + ' - Select Seats'}">Select Seats</h2>
            
            <div class="legend">
                <div class="legend-item">
                    <div class="seat"></div>
                    <small>Available</small>
                </div>
                <div class="legend-item">
                    <div class="seat selected"></div>
                    <small>Selected</small>
                </div>
                <div class="legend-item">
                    <div class="seat booked"></div>
                    <small>Booked</small>
                </div>
                <div class="legend-item">
                    <div class="seat vip"></div>
                    <small>VIP</small>
                </div>
                <div class="legend-item">
                    <div class="seat couple"></div>
                    <small>Couple</small>
                </div>
            </div>

            <div class="seat-container">
                <div class="screen">SCREEN</div>
                
                <form th:action="@{/movies/{movieId}/book(movieId=${movie.id})}" method="post" id="bookingForm">
                    <div class="seats">
                        <!-- Generate rows A through H -->
                        <th:block th:each="rowIndex : ${#numbers.sequence(0, 7)}">
                            <div class="seat-row">
                                <!-- Row label (A-H) -->
                                <span class="row-label" th:text="${#strings.substring('ABCDEFGH', rowIndex, rowIndex + 1)}">A</span>
                                
                                <!-- Generate 10 seats per row -->
                                <th:block th:each="colIndex : ${#numbers.sequence(1, 10)}">
                                    <div th:with="rowLetter=${#strings.substring('ABCDEFGH', rowIndex, rowIndex + 1)},
                                                seatNum=${rowLetter + colIndex}"
                                         th:attr="data-seat=${seatNum}"
                                         th:class="${'seat ' + 
                                                   (colIndex >= 4 && colIndex <= 7 ? 'vip ' : '') + 
                                                   (rowLetter == 'H' && colIndex % 2 != 0 ? 'couple ' : '')}"
                                         onclick="selectSeat(this)"
                                         th:text="${rowLetter == 'H' && colIndex % 2 != 0 ? seatNum + '/' + rowLetter + (colIndex + 1) : seatNum}"></div>
                                    <input type="checkbox" name="selectedSeats" th:value="${seatNum}" style="display: none;">
                                </th:block>
                            </div>
                        </th:block>
                    </div>

                    <div class="summary">
                        <p>Selected Seats: <span id="selectedSeatsText">None</span></p>
                        <p>Total Price: $<span id="totalPrice">0</span></p>
                        <button type="submit" class="btn btn-primary" id="bookButton" disabled>
                            Book Selected Seats
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <script th:inline="javascript">
            const seatPrices = {
                'STANDARD': 10,
                'VIP': 15,
                'COUPLE': 25
            };

            function selectSeat(element) {
                if (element.classList.contains('booked')) return;
                
                element.classList.toggle('selected');
                const checkbox = document.querySelector(`input[value="${element.dataset.seat}"]`);
                checkbox.checked = element.classList.contains('selected');
                
                updateSummary();
            }

            function updateSummary() {
                const selectedSeats = document.querySelectorAll('.seat.selected');
                const seatNumbers = Array.from(selectedSeats).map(seat => seat.dataset.seat);
                
                let total = 0;
                selectedSeats.forEach(seat => {
                    if (seat.classList.contains('vip')) {
                        total += seatPrices.VIP;
                    } else if (seat.classList.contains('couple')) {
                        total += seatPrices.COUPLE;
                    } else {
                        total += seatPrices.STANDARD;
                    }
                });

                document.getElementById('selectedSeatsText').textContent = 
                    seatNumbers.length ? seatNumbers.join(', ') : 'None';
                document.getElementById('totalPrice').textContent = total;
                document.getElementById('bookButton').disabled = seatNumbers.length === 0;
            }
        </script>
    </main>
</body>
</html>